<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Courses | FinLit</title>
  <link href="/css/output.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body class="bg-gray-50">
  <%- include('./partials/sidebar', { activePage: 'my-courses' }) %>
  <%- include('./partials/header', { user: user }) %>

  <!-- Main Content Area -->
  <main class="pt-16 md:ml-64 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Page Header -->
      <div class="bg-gradient-to-r from-blue-600 to-blue-500 rounded-lg p-6 text-white mb-6">
        <h2 class="text-2xl font-bold">My Courses</h2>
        <p class="mt-1 opacity-90">Continue your learning journey</p>
      </div>

      <!-- Course Navigation Tabs -->
      <div class="mb-6 border-b border-gray-200">
        <nav class="-mb-px flex space-x-8">
          <button onclick="showSection('enrolled')" class="tab-button active border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
            Enrolled Courses
          </button>
          <button onclick="showSection('available')" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
            Available Courses
          </button>
        </nav>
      </div>

      <!-- Enrolled Courses Section -->
      <div id="enrolled-section" class="course-section">
        <% if (enrolledCourses && enrolledCourses.length > 0) { %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% enrolledCourses.forEach(course => { %>
              <div class="bg-white rounded-lg border border-gray-200 overflow-hidden hover:border-blue-300 transition-colors">
                <div class="h-48 relative">
                  <img src="<%= course.thumbnail || '/images/default-course.jpg' %>" 
                       alt="<%= course.title %>" 
                       class="w-full h-full object-cover">
                  <div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-300">
                    <div class="h-full bg-blue-600" style="width: <%= course.progress || 0 %>%;"></div>
                  </div>
                </div>
                <div class="p-6">
                  <h4 class="font-medium text-gray-900 mb-2"><%= course.title %></h4>
                  <p class="text-sm text-gray-600 mb-4 line-clamp-2"><%= course.description %></p>
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-500"><%= course.progress || 0 %>% Complete</span>
                    <a href="/courses/<%= course._id %>" 
                       class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors">
                      Continue Learning
                      <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                  </div>
                </div>
              </div>
            <% }); %>
          </div>
        <% } else { %>
          <!-- No Courses State -->
          <div class="bg-white rounded-lg border border-gray-200 p-8 text-center">
            <div class="max-w-md mx-auto">
              <div class="text-blue-600 mb-4">
                <i class="fas fa-book-open text-5xl"></i>
              </div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">No Courses Yet</h3>
              <p class="text-gray-600 mb-6">You haven't enrolled in any courses yet. Start your learning journey today!</p>
              <button onclick="showSection('available')" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                Browse Courses
                <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        <% } %>
      </div>

      <!-- Available Courses Section -->
      <div id="available-section" class="course-section hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% courses.forEach(course => { 
            const isEnrolled = enrolledCourses && enrolledCourses.some(enrolled => enrolled._id.toString() === course._id.toString());
            const enrolledCourse = isEnrolled ? enrolledCourses.find(enrolled => enrolled._id.toString() === course._id.toString()) : null;
          %>
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden hover:border-blue-300 transition-colors">
              <div class="h-48 relative">
                <img src="<%= course.thumbnail || '/images/default-course.jpg' %>" 
                     alt="<%= course.title %>" 
                     class="w-full h-full object-cover">
                <% if (isEnrolled && enrolledCourse && enrolledCourse.progress) { %>
                  <div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-300">
                    <div class="h-full bg-blue-600" style="width: <%= enrolledCourse.progress %>%;"></div>
                  </div>
                <% } %>
              </div>
              <div class="p-6">
                <h4 class="font-medium text-gray-900 mb-2"><%= course.title %></h4>
                <p class="text-sm text-gray-600 mb-4 line-clamp-2"><%= course.description %></p>
                <div class="flex justify-between items-center">
                  <% if (isEnrolled) { %>
                    <span class="text-sm text-gray-500">
                      <% if (enrolledCourse && enrolledCourse.progress) { %>
                        <%= enrolledCourse.progress %>% Complete
                      <% } else { %>
                        Enrolled
                      <% } %>
                    </span>
                    <a href="/courses/<%= course._id %>" 
                       class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors">
                      Continue Learning
                      <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                  <% } else { %>
                    <span class="text-sm text-gray-500">
                      <% if (course.isNew) { %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">New</span>
                      <% } else if (course.isPopular) { %>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Popular</span>
                      <% } else { %>
                        <span class="text-xs text-gray-500">Course</span>
                      <% } %>
                    </span>
                    <div class="flex flex-col sm:flex-row gap-2 justify-center mt-4">
                      <a href="/courses/<%= course._id %>" 
                         class="inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 text-sm rounded-md hover:bg-gray-200 transition-colors w-full sm:w-auto justify-center">
                        View Details
                        <i class="fas fa-info-circle ml-2"></i>
                      </a>
                      <form action="/courses/enroll/<%= course._id %>" method="POST" class="inline w-full sm:w-auto">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors w-full sm:w-auto justify-center">
                          Enroll Now
                          <i class="fas fa-user-plus ml-2"></i>
                        </button>
                      </form>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    </div>
  </main>

  <script>
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.course-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      document.getElementById(`${sectionId}-section`).classList.remove('hidden');
      
      // Update tab styles
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('border-blue-500', 'text-blue-600', 'active');
        button.classList.add('border-transparent', 'text-gray-500');
      });
      
      // Style active tab
      const activeButton = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
      activeButton.classList.remove('border-transparent', 'text-gray-500');
      activeButton.classList.add('border-blue-500', 'text-blue-600', 'active');
    }
  </script>

  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</body>
</html>
